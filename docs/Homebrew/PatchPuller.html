<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Homebrew::PatchPuller
  
    &mdash; Homebrew Ruby API
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Homebrew::PatchPuller";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (P)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Homebrew.html" title="Homebrew (module)">Homebrew</a></span></span>
     &raquo; 
    <span class="title">PatchPuller</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Homebrew::PatchPuller
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Homebrew::PatchPuller</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>brew/Library/Homebrew/dev-cmd/pull.rb</dd>
  </dl>
  
</div>





  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#base_url-instance_method" title="#base_url (instance method)">#<strong>base_url</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the value of attribute base_url.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#patch_url-instance_method" title="#patch_url (instance method)">#<strong>patch_url</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the value of attribute patch_url.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#patchpath-instance_method" title="#patchpath (instance method)">#<strong>patchpath</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the value of attribute patchpath.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#apply_patch-instance_method" title="#apply_patch (instance method)">#<strong>apply_patch</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fetch_patch-instance_method" title="#fetch_patch (instance method)">#<strong>fetch_patch</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(url, args, description = nil)  &#x21d2; PatchPuller </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A new instance of PatchPuller.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pull_merge_commit-instance_method" title="#pull_merge_commit (instance method)">#<strong>pull_merge_commit</strong>(issue)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pull_patch-instance_method" title="#pull_patch (instance method)">#<strong>pull_patch</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(url, args, description = nil)  &#x21d2; <tt><span class='object_link'><a href="" title="Homebrew::PatchPuller (class)">PatchPuller</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a new instance of PatchPuller.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


312
313
314
315
316
317
318
319</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'brew/Library/Homebrew/dev-cmd/pull.rb', line 312</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_url'>url</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='id identifier rubyid_description'>description</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='ivar'>@base_url</span> <span class='op'>=</span> <span class='id identifier rubyid_url'>url</span>  <span class='comment'># GitHub provides commits/pull-requests raw patches using this URL.
</span>
  <span class='ivar'>@patch_url</span> <span class='op'>=</span> <span class='id identifier rubyid_url'>url</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.patch</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@patchpath</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../top-level-namespace.html#HOMEBREW_CACHE-constant" title="HOMEBREW_CACHE (constant)">HOMEBREW_CACHE</a></span></span> <span class='op'>+</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_basename'>basename</span><span class='lparen'>(</span><span class='id identifier rubyid_patch_url'>patch_url</span><span class='rparen'>)</span>
  <span class='ivar'>@description</span> <span class='op'>=</span> <span class='id identifier rubyid_description'>description</span>
  <span class='ivar'>@args</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="base_url-instance_method">
  
    #<strong>base_url</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the value of attribute base_url.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


308
309
310</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'brew/Library/Homebrew/dev-cmd/pull.rb', line 308</span>

<span class='kw'>def</span> <span class='id identifier rubyid_base_url'>base_url</span>
  <span class='ivar'>@base_url</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="patch_url-instance_method">
  
    #<strong>patch_url</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the value of attribute patch_url.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


309
310
311</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'brew/Library/Homebrew/dev-cmd/pull.rb', line 309</span>

<span class='kw'>def</span> <span class='id identifier rubyid_patch_url'>patch_url</span>
  <span class='ivar'>@patch_url</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="patchpath-instance_method">
  
    #<strong>patchpath</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the value of attribute patchpath.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


310
311
312</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'brew/Library/Homebrew/dev-cmd/pull.rb', line 310</span>

<span class='kw'>def</span> <span class='id identifier rubyid_patchpath'>patchpath</span>
  <span class='ivar'>@patchpath</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="apply_patch-instance_method">
  
    #<strong>apply_patch</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'brew/Library/Homebrew/dev-cmd/pull.rb', line 348</span>

<span class='kw'>def</span> <span class='id identifier rubyid_apply_patch'>apply_patch</span>  <span class='comment'># Applies a patch previously downloaded with fetch_patch()
</span>  <span class='comment'># Deletes the patch file as a side effect, regardless of success
</span>

  <span class='id identifier rubyid_ohai'>ohai</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Applying patch</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_patch_args'>patch_args</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>  <span class='comment'># Normally we don&#39;t want whitespace errors, but squashing them can break
</span>  <span class='comment'># patches so an option is provided to skip this step.
</span>
  <span class='id identifier rubyid_patch_args'>patch_args</span> <span class='op'>&lt;&lt;</span> <span class='kw'>if</span> <span class='ivar'>@args</span><span class='period'>.</span><span class='id identifier rubyid_ignore_whitespace?'>ignore_whitespace?</span> <span class='op'>||</span> <span class='ivar'>@args</span><span class='period'>.</span><span class='id identifier rubyid_clean?'>clean?</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--whitespace=nowarn</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--whitespace=fix</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># Fall back to three-way merge if patch does not apply cleanly
</span>  <span class='id identifier rubyid_patch_args'>patch_args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-3</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_patch_args'>patch_args</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_patchpath'>patchpath</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_safe_system'>safe_system</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>git</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>am</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_patch_args'>patch_args</span>
  <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="../ErrorDuringExecution.html" title="ErrorDuringExecution (class)">ErrorDuringExecution</a></span></span>
    <span class='kw'>if</span> <span class='ivar'>@args</span><span class='period'>.</span><span class='id identifier rubyid_resolve?'>resolve?</span>
      <span class='id identifier rubyid_odie'>odie</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Patch failed to apply: try to resolve it.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_system'>system</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>git</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>am</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--abort</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_odie'>odie</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Patch failed to apply: aborted.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_patchpath'>patchpath</span><span class='period'>.</span><span class='id identifier rubyid_unlink'>unlink</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fetch_patch-instance_method">
  
    #<strong>fetch_patch</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


341
342
343
344
345
346</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'brew/Library/Homebrew/dev-cmd/pull.rb', line 341</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_patch'>fetch_patch</span>
  <span class='id identifier rubyid_extra_msg'>extra_msg</span> <span class='op'>=</span> <span class='ivar'>@description</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='ivar'>@description</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_ohai'>ohai</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Fetching patch </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_extra_msg'>extra_msg</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Patch: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_patch_url'>patch_url</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_curl_download'><span class='object_link'><a href="../top-level-namespace.html#curl_download-instance_method" title="#curl_download (method)">curl_download</a></span></span> <span class='id identifier rubyid_patch_url'>patch_url</span><span class='comma'>,</span> <span class='label'>to:</span> <span class='id identifier rubyid_patchpath'>patchpath</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pull_merge_commit-instance_method">
  
    #<strong>pull_merge_commit</strong>(issue)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


326
327
328
329
330
331
332
333
334
335
336
337
338
339</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'brew/Library/Homebrew/dev-cmd/pull.rb', line 326</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pull_merge_commit'>pull_merge_commit</span><span class='lparen'>(</span><span class='id identifier rubyid_issue'>issue</span><span class='rparen'>)</span>
  <span class='comment'># Used by forks of homebrew-core that use merge-commits (for example linuxbrew)
</span>  <span class='id identifier rubyid_ohai'>ohai</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Fast-forwarding to the merge commit</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_test_bot_origin'>test_bot_origin</span> <span class='op'>=</span> <span class='id identifier rubyid_patch_url'>patch_url</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>(https://github\.com/[\w-]+/[\w-]+)/compare/</span><span class='regexp_end'>}</span></span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_safe_system'>safe_system</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>git</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>fetch</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--quiet</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_test_bot_origin'>test_bot_origin</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pr-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_issue'>issue</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_test_bot_origin'>test_bot_origin</span>
  <span class='id identifier rubyid_safe_system'>safe_system</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>git</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>merge</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--quiet</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--ff-only</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--no-edit</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FETCH_HEAD</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='gvar'>$CHILD_STATUS</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>

  <span class='id identifier rubyid_safe_system'>safe_system</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>git</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>reset</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>--hard</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FETCH_HEAD</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_odie'>odie</span> <span class='heredoc_beg'>&lt;&lt;~EOS</span>
<span class='tstring_content'>    Not possible to fast-forward.
</span><span class='tstring_content'>    Maybe somebody pushed commits to origin/master between the merge commit creation and now.
</span><span class='heredoc_end'>  EOS
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pull_patch-instance_method">
  
    #<strong>pull_patch</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


321
322
323
324</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'brew/Library/Homebrew/dev-cmd/pull.rb', line 321</span>

<span class='kw'>def</span> <span class='id identifier rubyid_pull_patch'>pull_patch</span>
  <span class='id identifier rubyid_fetch_patch'>fetch_patch</span>
  <span class='id identifier rubyid_apply_patch'>apply_patch</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>